<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô MQTT</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #f7f7f7;
    margin-top: 50px;
  }
  button {
    font-size: 20px;
    padding: 10px 20px;
    margin: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .on { background-color: #4CAF50; color: white; }
  .off { background-color: #f44336; color: white; }
  #status, #temp, #humi {
    margin-top: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>
<h2>üí° ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô MQTT</h2>
<button class="on" onclick="turnOn()">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</button>
<button class="off" onclick="turnOff()">‡∏õ‡∏¥‡∏î‡πÑ‡∏ü</button>

<div id="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
<div id="temp">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: -- ¬∞C</div>
<div id="humi">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: -- %</div>

<script>
  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MQTT
  const broker = "wss://broker.hivemq.com:8884/mqtt";
  const topicControl = "espkuy";   // topic ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏ü
  const topicTemp = "tempjee";   // topic ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥
  const topicHumi = "humijee";   // topic ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á client MQTT
  const client = mqtt.connect(broker);

  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
  client.on("connect", function () {
    document.getElementById("status").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß";
    // ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ü‡∏±‡∏á topic ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß
    
    client.subscribe(topicControl);
    client.subscribe(topicTemp);
    client.subscribe(topicHumi);
  });

  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å broker
  client.on("message", function (topic, message) {
    const msg = message.toString();

    if(topic === topicControl){
      document.getElementById("status").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏ü: " + msg;
    } else if(topic === topicTemp){
      document.getElementById("temp").innerText = "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: " + msg + " ¬∞C";
    } else if(topic === topicHumi){
      document.getElementById("humi").innerText = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: " + msg + " %";
    }
  });

  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
  client.on("error", function (err) {
    console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err);
    document.getElementById("status").innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
  });

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü
  function turnOn() {
    client.publish(topicControl, "ON");
    document.getElementById("status").innerText = "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü";
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡πÑ‡∏ü
  function turnOff() {
    client.publish(topicControl, "OFF");
    document.getElementById("status").innerText = "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü";
  }
</script>
</body>
</html>
